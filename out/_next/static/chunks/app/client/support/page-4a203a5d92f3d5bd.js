(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8500],{12270:(e,t,s)=>{"use strict";var r=Object.defineProperty,n=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,a=Object.prototype.hasOwnProperty,i=(e,t,s)=>new Promise((r,n)=>{var o=e=>{try{i(s.next(e))}catch(e){n(e)}},a=e=>{try{i(s.throw(e))}catch(e){n(e)}},i=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,a);i((s=s.apply(e,t)).next())}),l={};((e,t)=>{for(var s in t)r(e,s,{get:t[s],enumerable:!0})})(l,{SessionContextProvider:()=>m,useSession:()=>f,useSessionContext:()=>h,useSupabaseClient:()=>x,useUser:()=>p}),e.exports=((e,t,s,i)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let s of o(t))a.call(e,s)||void 0===s||r(e,s,{get:()=>t[s],enumerable:!(i=n(t,s))||i.enumerable});return e})(r({},"__esModule",{value:!0}),l);var u=s(12115),c=s(95155),d=(0,u.createContext)({isLoading:!0,session:null,error:null,supabaseClient:{}}),m=({supabaseClient:e,initialSession:t=null,children:s})=>{let[r,n]=(0,u.useState)(t),[o,a]=(0,u.useState)(!t),[l,m]=(0,u.useState)();(0,u.useEffect)(()=>{!r&&t&&n(t)},[r,t]),(0,u.useEffect)(()=>{let t=!0;return!function(){i(this,null,function*(){let{data:{session:s},error:r}=yield e.auth.getSession();if(t){if(r){m(r),a(!1);return}n(s),a(!1)}})}(),()=>{t=!1}},[]),(0,u.useEffect)(()=>{let{data:{subscription:t}}=e.auth.onAuthStateChange((e,t)=>{t&&("SIGNED_IN"===e||"TOKEN_REFRESHED"===e||"USER_UPDATED"===e)&&n(t),"SIGNED_OUT"===e&&n(null)});return()=>{t.unsubscribe()}},[]);let h=(0,u.useMemo)(()=>o?{isLoading:!0,session:null,error:null,supabaseClient:e}:l?{isLoading:!1,session:null,error:l,supabaseClient:e}:{isLoading:!1,session:r,error:null,supabaseClient:e},[o,r,l]);return(0,c.jsx)(d.Provider,{value:h,children:s})},h=()=>{let e=(0,u.useContext)(d);if(void 0===e)throw Error("useSessionContext must be used within a SessionContextProvider.");return e};function x(){let e=(0,u.useContext)(d);if(void 0===e)throw Error("useSupabaseClient must be used within a SessionContextProvider.");return e.supabaseClient}var f=()=>{let e=(0,u.useContext)(d);if(void 0===e)throw Error("useSession must be used within a SessionContextProvider.");return e.session},p=()=>{var e,t;let s=(0,u.useContext)(d);if(void 0===s)throw Error("useUser must be used within a SessionContextProvider.");return null!=(t=null==(e=s.session)?void 0:e.user)?t:null}},51585:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var r=s(95155),n=s(12270),o=s(12115);let a=s(64983).supabase;function i(){let e=(0,n.useUser)(),[t,s]=(0,o.useState)([]),[i,l]=(0,o.useState)(""),u=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=a.channel("chat-room").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages"},e=>{s(t=>[...t,e.new])}).subscribe();return()=>{a.removeChannel(e)}},[]),(0,o.useEffect)(()=>{(async()=>{let{data:e,error:t}=await a.from("messages").select("*").order("created_at",{ascending:!0});t||s(e)})()},[]),(0,o.useEffect)(()=>{var e;null==(e=u.current)||e.scrollIntoView({behavior:"smooth"})},[t]);let c=async()=>{i.trim()&&e&&(await a.from("messages").insert({user_id:e.id,role:"user",content:i.trim()}),l(""))};return e?(0,r.jsxs)("div",{className:"max-w-xl mx-auto p-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Чат с поддержкой"}),(0,r.jsxs)("div",{className:"border rounded p-4 h-[400px] overflow-y-auto bg-white shadow-sm space-y-2 mb-4",children:[t.map(e=>(0,r.jsxs)("div",{className:"max-w-[70%] px-3 py-2 rounded text-sm ".concat("admin"===e.role?"bg-gray-200 self-start":"bg-blue-100 self-end ml-auto"),children:[(0,r.jsx)("p",{children:e.content}),(0,r.jsx)("p",{className:"text-[10px] text-right text-gray-500",children:new Date(e.created_at).toLocaleTimeString()})]},e.id)),(0,r.jsx)("div",{ref:u})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("input",{type:"text",value:i,onChange:e=>l(e.target.value),placeholder:"Напишите сообщение...",className:"flex-1 border px-3 py-2 rounded"}),(0,r.jsx)("button",{onClick:c,className:"bg-black text-white px-4 py-2 rounded hover:bg-gray-800 transition",children:"Отправить"})]})]}):(0,r.jsx)("div",{className:"p-6 text-center text-gray-500",children:"Пожалуйста, войдите в аккаунт"})}},58010:(e,t,s)=>{Promise.resolve().then(s.bind(s,51585))},64983:(e,t,s)=>{"use strict";s.r(t),s.d(t,{supabase:()=>r});let r=(0,s(34982).UU)("https://fjzbgaflzavzcwfoozcs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqemJnYWZsemF2emN3Zm9vemNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDczOTM4ODMsImV4cCI6MjA2Mjk2OTg4M30.mTC_-_hacoYgO4gAhXE1A9QoW-V6oS6UNfozzlrh_w4")}},e=>{var t=t=>e(e.s=t);e.O(0,[4982,8441,1684,7358],()=>t(58010)),_N_E=e.O()}]);