(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[966],{64983:(e,s,l)=>{"use strict";l.r(s),l.d(s,{supabase:()=>a});let a=(0,l(34982).UU)("https://fjzbgaflzavzcwfoozcs.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqemJnYWZsemF2emN3Zm9vemNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDczOTM4ODMsImV4cCI6MjA2Mjk2OTg4M30.mTC_-_hacoYgO4gAhXE1A9QoW-V6oS6UNfozzlrh_w4")},94973:(e,s,l)=>{"use strict";l.r(s),l.d(s,{default:()=>n});var a=l(95155),r=l(12115),i=l(90732),t=l.n(i),c=l(64983);function n(){let[e,s]=(0,r.useState)(null),[l,i]=(0,r.useState)(""),[n,o]=(0,r.useState)([]),d=async()=>{if(!e)return i("❌ Файл не выбран.");i("⏳ Чтение и обработка файла...");let s=await e.text();try{var l,a;let e=new(t()).Parser({explicitArray:!1,trim:!0}),r=await e.parseStringPromise(s),n=(null==r||null==(a=r.kaspi_catalog)||null==(l=a.offers)?void 0:l.offer)?Array.isArray(r.kaspi_catalog.offers.offer)?r.kaspi_catalog.offers.offer:[r.kaspi_catalog.offers.offer]:null;if(!n)return void i("❌ Не удалось найти товары в XML.");let d=n.map(e=>{var s,l,a,r;let i=null==(s=e.cityprices)?void 0:s.cityprice,t=null==(l=e.availabilities)?void 0:l.availability,c=e.model||"",n=e.img?[e.img]:[];return{sku:e.$.sku,model:c,brand:function(e){let s=e.toLowerCase();return s.includes("iphone")||s.includes("apple")?"Apple":s.includes("samsung")?"Samsung":s.includes("redmi")||s.includes("xiaomi")?"Xiaomi":s.includes("realme")?"Realme":s.includes("jbl")?"JBL":s.includes("huawei")?"Huawei":s.includes("honor")?"Honor":s.includes("asus")?"ASUS":"Неизвестно"}(c),price:Array.isArray(i)?parseFloat(i[0]._):parseFloat(i._),stock_count:(null==t||null==(a=t.$)?void 0:a.stockCount)?parseInt(t.$.stockCount):0,available:(null==t||null==(r=t.$)?void 0:r.available)==="yes",created_at:new Date().toISOString(),updated_at:new Date().toISOString(),img:n.length>0?n[0]:null}}).filter(e=>e.sku&&"number"==typeof e.price&&!isNaN(e.price)),{error:p}=await c.supabase.from("products").upsert(d,{onConflict:"sku"});p?(console.error(p),i("❌ Ошибка при вставке в базу: ".concat(p.message))):(i("✅ Загружено товаров: ".concat(d.length)),o(d.slice(0,10)))}catch(e){console.error(e),i("❌ Ошибка при парсинге XML.")}};return(0,a.jsxs)("main",{className:"p-6 sm:p-10",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Загрузка XML товаров"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4 mb-6",children:[(0,a.jsx)("input",{type:"file",accept:".xml",onChange:e=>{var l;s((null==(l=e.target.files)?void 0:l[0])||null),i("")}}),(0,a.jsx)("button",{onClick:d,className:"bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700",children:"Загрузить в базу"})]}),l&&(0,a.jsx)("p",{className:"text-blue-600 mb-4",children:l}),n.length>0&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Превью товаров:"}),(0,a.jsxs)("table",{className:"w-full text-sm bg-white border",children:[(0,a.jsx)("thead",{className:"bg-gray-100",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"border px-2 py-1",children:"SKU"}),(0,a.jsx)("th",{className:"border px-2 py-1",children:"Модель"}),(0,a.jsx)("th",{className:"border px-2 py-1",children:"Бренд"}),(0,a.jsx)("th",{className:"border px-2 py-1",children:"Цена"}),(0,a.jsx)("th",{className:"border px-2 py-1",children:"В наличии"}),(0,a.jsx)("th",{className:"border px-2 py-1",children:"Остаток"}),(0,a.jsx)("th",{className:"border px-2 py-1",children:"Фото"})]})}),(0,a.jsx)("tbody",{children:n.map((e,s)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border px-2 py-1",children:e.sku}),(0,a.jsx)("td",{className:"border px-2 py-1",children:e.model}),(0,a.jsx)("td",{className:"border px-2 py-1",children:e.brand}),(0,a.jsx)("td",{className:"border px-2 py-1",children:e.price}),(0,a.jsx)("td",{className:"border px-2 py-1",children:e.available?"Да":"Нет"}),(0,a.jsx)("td",{className:"border px-2 py-1",children:e.stock_count}),(0,a.jsx)("td",{className:"border px-2 py-1",children:e.img&&(0,a.jsx)("img",{src:e.img,alt:"Product",className:"w-16 h-16"})})]},s))})]})]})]})}},95963:(e,s,l)=>{Promise.resolve().then(l.bind(l,94973))}},e=>{var s=s=>e(e.s=s);e.O(0,[4982,732,8441,1684,7358],()=>s(95963)),_N_E=e.O()}]);